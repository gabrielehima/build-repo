name: apply

on: 
  workflow_call:
    inputs:
      target-env:
        required: true
        type: string

jobs:
  check:
    runs-on: ubuntu-latest
    outputs:
      selected-stage: ${{ steps.selected-environment.outputs.selected-stage }}
    steps:
    - name: select environment
      id: select-environment
      run: |
        if [ ${{ inputs.target-env }} == dev ]; then
          echo "selected-stage=dev" >>  "$GITHUB_OUTPUT"
        elif [ ${{ inputs.target-env }} == dev ]; then
          echo "selected-stage=stage" >>  "$GITHUB_OUTPUT"
        elif [ ${{ inputs.target-env }} == dev ]; then
          echo "selected-stage=prod" >>  "$GITHUB_OUTPUT"
        else
          echo " select a valid environment"
        fi
  deploy-dev:
    needs: check
    runs-on: ubuntu-latest
    if: ${{ needs.check.outputs.selected == 'dev' }}
    steps:
      - run: echo "Deploying to dev"

  deploy-stage:
    needs: check
    runs-on: ubuntu-latest
    if: ${{ needs.check.outputs.selected == 'stage' }}
    steps:
      - run: echo "Deploying to stage"
      
  deploy-prod:
    needs: check
    runs-on: ubuntu-latest
    if: ${{ needs.check.outputs.selected == 'prod' }}
    steps:
      - run: echo "Deploying to prod"
        
